# План реализации системы «Категории 2.0» (Максимальный)

Этот план составлен на основе всех 50 ответов Q&A. Он учитывает специфическую логику сортировки, запреты на перемещение и технические нюансы иерархии.

## Этап 1: База данных и Пермалинки
*   **Задача 1.1:** Расширение таблицы `categories`:
    *   `slug` (для ЧПУ ссылок в браузере).
    *   `fullPath` (хранение полного пути текстом для ускорения фильтрации и поиска).
    *   `colorMarker` (поле для HEX-кода).
    *   `defaultUnit` (предустановка: шт или выбор).
*   **Задача 1.2:** Скрипт транслитерации для `slug` (автогенерация из названия).
*   **Задача 1.3:** Интеграция `Permalinks`: использование `slug` в URL вместо UUID для всех разделов склада.

## Этап 2: Единицы измерения и Валидация
*   **Задача 2.1:** Жесткая привязка ед. изм. в UI и API:
    *   Для категорий «Одежда» и «Упаковка» — автоматическая установка `шт` (поле заблокировано).
    *   Для категории «Расходники» — предоставление свободного выбора при создании товара.
*   **Задача 2.2:** Блокировка редактирования ед. изм. для существующих товаров в системных категориях.

## Этап 3: Техническая иерархия и API
*   **Задача 3.1:** Разработка API-методов:
    *   `getTree`: для построения меню навигации.
    *   `getFlat`: для выпадающих списков выбора родителя.
*   **Задача 3.2:** Защита от деления на ноль и циклов: механизм валидации при сохранении, запрещающий категории становиться родителем самой себе или своим потомкам.
*   **Задача 3.3:** Логика «Без категории»: при отсутствии привязки товар попадает в системный раздел, который открывает таблицу позиций напрямую (минуя выбор подкатегорий).

## Этап 4: Навигация и Хлебные крошки
*   **Задача 4.1:** Внедрение Breadcrumbs: Склад > Категория > Подкатегория > Товар.
*   **Задача 4.2:** Логика переходов: если в категории нет подкатегорий, система должна сразу отображать список товаров, а не пустую папку.

## Этап 5: UI и Визуализация
*   **Задача 5.1:** Работа с заголовками: настройка `line-clamp-2` (перенос на 2 строки) в `ItemHeader` и карточках.
*   **Задача 5.2:** Цветовое кодирование: отображение маркеров в списках категорий.
*   **Задача 5.3:** Отображение иконок для основных категорий (Одежда, Упаковка, Расходники).

## Этап 6: Сортировка и Группировка
*   **Задача 6.1:** Реализация жесткого порядка:
    1. Одежда
    2. Упаковка
    3. Расходники
    4. [Все новые пользовательские категории]
    5. Без категории (всегда в конце)
*   **Задача 6.2:** Иерархическая сортировка: подкатегории внутри родителя сортируются по алфавиту.

## Эта- 7: Безопасность и Удаление
*   **Задача 7.1:** Контроль удаления (`DeleteGuard`): запрет на удаление категории/подкатегории, если в ней есть товары.
*   **Задача 7.2:** Запрет удаления атрибутов, если они уже заполнены в карточках товаров.
*   **Задача 7.3:** Блокировка перемещений: отключение функции смены категории у созданного товара.

## Этап 8: Роли и Редактирование
*   **Задача 8.1:** Права доступа: создание и правка категорий только для ролей «Руководство» и «Отдел продаж».
*   **Задача 8.2:** Логика «Last Version Wins»: сохранение последней отправленной версии данных без блокировки интерфейса для других.

## Этап 9: Кеширование и Скорость
*   **Задача 9.1:** Внедрение серверного кеширования дерева категорий для мгновенной загрузки при навигации.
*   **Задача 9.2:** Оптимизация поиска по `fullPath`.

## Этап 10: Реализация Roadmap
*   **Задача 10.1:** Архитектурная подготовка для «Корневой категории» (Root Category).
*   **Задача 10.2:** Создание логов изменений настроек (Audit Trail) для категорий.
*   **Задача 10.3:** Финальное тестирование сценария «Категория -> Подкатегория -> Позиция».
