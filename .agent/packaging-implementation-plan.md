# План реализации: Создание позиции «Упаковка» V2

Данный план обновлен с учетом требований по простоте и специфике учета упаковки (ручной выбор в заказе, списание коробок поштучно).

## 1. Подготовка данных и типов (Backend/DB)

*   **Атрибуты (Inventory Attributes)**:
    *   Убедиться, что JSONB поле `attributes` поддерживает новые ключи:
        *   `width`, `height`, `depth` (габариты в мм)
        *   `weight` (вес в граммах, для расчета доставки)
        *   `supplier_link` (ссылка на поставщика)
        *   `supplier_name` (название поставщика)
        *   `min_batch` (минимальная партия)
        *   `features` (массив особенности: `glued_valve`, `tear_tape`)
    *   Проверить наличие `unit` = `meters` (для рулонных материалов).

## 2. Логика на клиенте (Frontend)

### 2.1. Определение контекста
*   В `NewItemPageClient`:
    *   Если выбранная категория содержит "Упаковка", активируем режим `isPackaging`.

### 2.2. Новый шаг `PackagingBasicInfoStep`
Создать компонент (или модифицировать `BasicInfoStep`) со следующими блоками:

1.  **Основная информация**:
    *   **Подкатегория**: Выбор (Коробка S/M/L, Пакет, Тубус).
    *   **Назначение**: Транспортная / Индивидуальная.
    *   **Бренд**: Стандартный селектор.
2.  **Параметры**:
    *   **Габариты (Д×Ш×В)**: 3 обязательных поля.
    *   **Вес**: Обязательное поле.
    *   **Размер**: S/M/L (необязательно, если заданы габариты, но лучше оставить для быстрого поиска).
    *   **Материал**: Выпадающий список.
    *   **Цвет**: Палитра (как у одежды).
    *   **Особенности**: Чекбоксы (Клеевой клапан, Отрывная лента).
3.  **Логистика и Закупка**:
    *   **Поставщик**: Поле ввода названия + Поле ссылки.
    *   **Мин. партия**: Числовое поле.
    *   **Остатки**: Поля Мин. остаток / Крит. остаток (уже есть в `StockStep`, убедиться что они там доступны).

### 2.3. Авто-генерация
*   **Название**: `{Подкатегория} {Д}x{Ш}x{В} {Цвет} {Материал}`.
    *   Пример: "Коробка 300x200x100 Крафт Гофрокартон".
*   **SKU**: `PKG-{CAT}-{W}x{H}x{D}-{COLOR_CODE}`.

### 2.4. Медиа
*   Загрузка 1-3 фото (1 обязательное).

### 2.5. Дублирование
*   Добавить кнопку "Сохранить и создать копию" в конце флоу (на шаге `SummaryStep` или после успеха), чтобы менеджер мог сразу создать такой же пакет другого размера.

## 3. Интеграция с Заказами (Будущий этап)
*   Это выходит за рамки текущей задачи по *созданию* товара, но важно помнить:
    *   В заказе понадобится селектор "Добавить упаковку".
    *   При добавлении упаковки ее стоимость пойдет в `costPrice` заказа.
    *   Вес упаковки будет суммироваться с весом товаров.

## 4. Этапы разработки
1.  **Frontend**: Обновить `NewItemPageClient` и создать форму для упаковки.
2.  **Backend**: Проверить сохранение специфичных полей в JSONB.
3.  **Тестирование**: Создать тестовую коробку, проверить генерацию имени и сохранение ссылки на поставщика.
