# Технические стандарты разработки MerchCRM

Этот документ содержит правила и паттерны, которые необходимо соблюдать при разработке проекта.

## 1. Уведомления и взаимодействие с пользователем
- **Никаких стандартных браузерных уведомлений**: Не используйте `alert()`, `confirm()` или `prompt()`.
- **Кастомные уведомления**: Используйте хук `useToast` из `@/components/ui/toast`.
  - Пример использования: 
    ```tsx
    const { toast } = useToast();
    toast("Успешно сохранено", "success");
    toast("Произошла ошибка", "error");
    ```
- **Подтверждение действий**: Вместо `confirm()` используйте кастомные диалоговые окна на базе `@/components/ui/dialog`.

## 2. Стилизация и UI компоненты
- **Библиотека компонентов**: Все базовые UI элементы (кнопки, вводы, диалоги) должны браться из `components/ui`.
- **Иконки**: Используйте исключительно `lucide-react`.
- **Анимации**: При создании новых страниц или крупных блоков добавляйте классы `animate-in fade-in duration-500` для плавного появления.

## 3. Работа с данными
- **Server Actions**: Все изменения данных (INSERT, UPDATE, DELETE) должны проходить через Server Actions в соответствующих файлах `actions.ts`.
- **Валидация**: Используйте `zod` для валидации данных на стороне сервера.
- **Логирование**: Все важные действия (создание, удаление, изменение настроек) должны записываться в таблицу `audit_logs` через `db.insert(auditLogs)`.

## 4. Язык и локализация
- **Интерфейс**: Весь текст интерфейса должен быть на **русском языке**.
- **Даты**: Для форматирования дат используйте `date-fns` с локалью `ru`.
  ```tsx
  import { ru } from "date-fns/locale";
  format(date, "d MMMM yyyy", { locale: ru });
  ```

## 5. Доступ и Роли
- **Проверка прав**: Всегда проверяйте права пользователя (роль) как на стороне клиента (для скрытия элементов UI), так и на стороне сервера (в Server Actions).
- **Администратор**: Полный доступ ко всем настройкам и логам.

## 6. Работа с таблицами
- **Единообразие стиля**: Все таблицы в приложении должны иметь одинаковый визуальный стиль (отступы, скругления углов `rounded-[2rem]` или `rounded-3xl`, тени, hover-эффекты).
- **Чек-боксы**: Каждая таблица (Заказы, Клиенты, Склад, Логи и т.д.) должна иметь колонку с чек-боксами для массового выбора записей.
- **Пагинация**: Использование компонента `Pagination` из `@/components/ui/pagination` обязательно для всех таблиц с потенциально большим количеством данных.
- **Массовые действия**: При выборе чек-боксов должна появляться панель массовых действий (Bulk Actions Panel), зафиксированная в нижней части экрана.

## 7. Исправление ошибок и Рефакторинг
- **Сохранение дизайна**: При исправлении ошибок линтинга, типов (TypeScript) или техническом рефакторинге СТРОГО ЗАПРЕЩЕНО менять визуальный вид страницы, расположение элементов, отступы или логику UI.
- **Восстановление**: Если техническое исправление требует изменения структуры кода (например, разделения на компоненты), необходимо гарантировать, что итоговый рендер полностью соответствует оригиналу.
- **Проверка**: Перед коммитом технических правок сверяйте текущий вид страницы с предыдущим состоянием.
